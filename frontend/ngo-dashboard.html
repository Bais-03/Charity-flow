<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NGO Dashboard</title>
</head>
<body>
  <h1>Welcome to NGO Dashboard</h1>

  <h2>Request Items</h2>
  <form id="requestForm">
    <label>Item Type:</label>
    <select id="itemType" name="itemType" required>
      <option value="">Select Type</option>
      <option value="Clothes">Clothes</option>
      <option value="Plastic">Plastic</option>
      <option value="Wood">Wood</option>
      <option value="Electronics">Electronics</option>
      <option value="Others">Others</option>
    </select><br><br>

    <!-- Item Name Dropdown (Always visible) -->
    <label>Item Name:</label>
    <select id="itemName" name="itemName" required>
      <option value="">Select Item</option>
    </select><br><br>

    <!-- Custom item name input (conditionally shown) -->
    <div id="customItemNameContainer" style="display: none;">
      <label>Specify Item Name:</label>
      <input type="text" id="customItemName" placeholder="Enter item name"><br><br>
    </div>

    <label>Quantity:</label>
    <input type="number" name="quantity" required><br><br>

    <button type="submit">Request</button>
  </form>

  <br>
  <a href="ngo-requests.html">ðŸ“‹ View My Requests</a>

  <script>
    const ngoId = localStorage.getItem('ngoId');
    if (!ngoId) {
      alert("NGO not logged in!");
      window.location.href = "login.html";
    }

    const form = document.getElementById('requestForm');
    const itemTypeSelect = document.getElementById('itemType');
    const itemNameSelect = document.getElementById('itemName');
    const customNameDiv = document.getElementById('customItemNameContainer');
    const customNameInput = document.getElementById('customItemName');

    const itemNamesByType = {
      Clothes: ["Shirt", "Jacket", "Pants", "Blanket", "Others"],
      Plastic: ["Bottles", "Containers", "Bags", "Others"],
      Wood: ["Chair", "Table", "Shelf", "Others"],
      Electronics: ["Phone", "Laptop", "Charger", "Others"]
    };

    // Populate item names on item type change
    itemTypeSelect.addEventListener('change', function () {
      const selectedType = this.value;
      itemNameSelect.innerHTML = '<option value="">Select Item</option>';

      customNameDiv.style.display = 'none';
      customNameInput.required = false;
      customNameInput.value = '';

      if (itemNamesByType[selectedType]) {
        itemNamesByType[selectedType].forEach(name => {
          const option = document.createElement('option');
          option.value = name;
          option.textContent = name;
          itemNameSelect.appendChild(option);
        });
      } else if (selectedType === "Others") {
        // Force the item name to be "Others" and show the input field
        const option = document.createElement('option');
        option.value = "Others";
        option.textContent = "Others";
        itemNameSelect.appendChild(option);
        itemNameSelect.value = "Others";
        customNameDiv.style.display = 'block';
        customNameInput.required = true;
      }
    });

    // Handle selection of "Others" from item name
    itemNameSelect.addEventListener('change', function () {
      if (this.value === "Others") {
        customNameDiv.style.display = 'block';
        customNameInput.required = true;
      } else {
        customNameDiv.style.display = 'none';
        customNameInput.required = false;
        customNameInput.value = '';
      }
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const itemType = itemTypeSelect.value;
      let itemName = itemNameSelect.value;
      const quantity = parseInt(form.quantity.value);

      if (!itemType || !itemName || !quantity) {
        alert("Please fill out all fields.");
        return;
      }

      // Handle custom item name
      if (itemName === "Others" || itemType === "Others") {
        itemName = customNameInput.value.trim();
        if (!itemName) {
          alert("Please enter a custom item name.");
          return;
        }
      }

      try {
        const res = await fetch('http://localhost:5001/api/ngos/request', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ngoId, itemType, itemName, quantity })
        });

        const data = await res.json();
        if (res.ok) {
          alert("Request submitted successfully.");
          form.reset();
          itemNameSelect.innerHTML = '<option value="">Select Item</option>';
          customNameDiv.style.display = 'none';
        } else {
          alert(data.message || data.error || "Request failed");
        }
      } catch (err) {
        alert("Server error");
        console.error(err);
      }
    });
  </script>
</body>
</html>
