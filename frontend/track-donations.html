<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Track Donations</title>
</head>
<body>
    <a href="admin-dashboard.html">â¬… Back to Dashboard</a>
  <h2>Track Donations</h2>
  <div id="donationList"></div>

  <script>
    (async function () {
      const token = localStorage.getItem("adminToken");
      const res = await fetch("http://localhost:5001/api/donations", {
        headers: { Authorization: `Bearer ${token}` }
      });

      const donations = await res.json();
      const trackable = donations.filter(d => d.status === "Matched");

      const container = document.getElementById("donationList");

      trackable.forEach(d => {
        const div = document.createElement("div");
        div.innerHTML = `
          <h4>${d.itemName} (${d.itemType})</h4>
          <img src="http://localhost:5001/${d.photo}" width="150" />
          <p>Quantity: ${d.quantity}</p>
          <p>Status: ${d.status}</p>
          <button onclick="trackDonation('${d._id}')">Track</button>
          <hr/>
        `;
        container.appendChild(div);
      });
    })();

    async function trackDonation(id) {
      const token = localStorage.getItem("adminToken");

      const res = await fetch(`http://localhost:5001/api/donations/${id}/track`, {
        headers: { Authorization: `Bearer ${token}` }
      });

      const data = await res.json();
      alert(`Status: ${data.status}\nUser: ${data.userId?.name || 'N/A'}\nPickup Location: ${data.pickupLocation || 'N/A'}`);
    }
  </script>
</body>
</html>
